
<style type="text/css">
		.checked {
			color: orange;
		}
</style>

<nav class="navbar navbar-expand navbar-dark bg-dark static-top" style="display: flex; justify-content: space-between;">

    <a class="navbar-brand mr-1" href="/admin/home"><h4>HỆ THỐNG HỌC TRỰC TUYẾN</h4></a>

    {{!-- <button style="margin-left: -650px;"class="btn btn-link btn-sm text-white order-1 order-sm-0" id="sidebarToggle" href="#">
      <i class="fas fa-bars"></i>
    </button> --}}
    <button class="btn btn-link btn-sm text-white order-1 order-sm-0" id="sidebarToggle" href="#" style="text-align: left;">
      <i class="fas fa-bars"></i>
    </button>
    <!-- Navbar -->
    <!-- Navbar -->
    <ul class="navbar-nav ml-auto ml-md-0">
      <li class="nav-item dropdown no-arrow mx-1">
        
      </li>
      <li class="nav-item dropdown no-arrow mx-1">
        <h5 style="color: aliceblue;">Admin</h5>
      </li>
      <li class="nav-item dropdown no-arrow">
        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-user-circle fa-fw"></i>
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
          
          <a class="dropdown-item" href="/admin/profile">Hồ sơ cá nhân</a>
          <a class="dropdown-item" href="/changePassword">Đổi mật khẩu</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="/admin/logout" data-toggle="modal" data-target="#logoutModal">Đăng xuất</a>
        </div>
      </li>  
    </ul>

  </nav>

  <div id="wrapper">

    <!-- Sidebar -->
      <ul class="sidebar navbar-nav">
      <li class="nav-item active">
        <a class="nav-link" href="#">
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Mục lục</span>
        </a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="pagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-fw fa-folder"></i>
          <span>Quản lý học tập</span>
        </a>
        <div style="width: 100%" class="dropdown-menu" aria-labelledby="pagesDropdown">
                  <a class="dropdown-item" href="/admin/manage-courses">Quản lý khóa học</a>
                  <a class="dropdown-item" href="/admin/manage-category">Quản lý chủ đề</a>
                  <a class="dropdown-item" href="/admin/manage-newregister">Quản lý đăng ký mới</a>
        </div>
      </li>      
        
       <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="pagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-fw fa-folder"></i>
          <span>Quản Lý Tài Khoản</span>
        </a>
        <div class="dropdown-menu" aria-labelledby="pagesDropdown">
          <a class="dropdown-item" href="/admin/manage-students-account">Tài khoản người học</a>
          <a class="dropdown-item" href="/admin/manage-teachers-account">Tài khoản giáo viên</a>
          
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="pagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-fw fa-folder"></i>
          <span>Cài đặt</span>
        </a>
        <div class="dropdown-menu" aria-labelledby="pagesDropdown">
          <a class="dropdown-item" href="/admin/profile">Hồ sơ cá nhân</a>
          <a class="dropdown-item" href="/admin/changePassword">Đổi mật khẩu</a>
          
        </div>
      </li>
    </ul>

    <div id="content-wrapper">

      <div class="container-fluid">

        <!-- Breadcrumbs-->
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="/admin/home">Màn hình chính</a>
          </li>
          <li class="breadcrumb-item">
             Quản lý môn học
          </li>
          <li class="breadcrumb-item">
             Quản lý khóa học
          </li>
          <li class="breadcrumb-item active">Quản lý người học trong khóa {{dataClass.className}}</li>
        </ol>
        <div style="padding:10px" class="row">
              <div class="col-md-2">
                <a href="/admin/manage-class/edit/{{idClass}}" class="btn btn-outline-secondary btn-block mb-3" role="button" aria-pressed="true">Quay lại</a>
                <a href="/admin/manage-courses/addStudentToCourse/{{idClass}}" class="btn btn-primary btn-block mb-3" role="button" aria-pressed="true">Thêm người học mới  + </a>
                <a href="/admin/manage-courses/viewStudentBlockInCourse/{{idClass}}" class="btn btn-outline-warning btn-block mb-3" role="button" aria-pressed="true">Tài khoản bị block trong khóa</a>
              </div>
        
        <div class="col-md-10">
          <div class="card card-primary card-outline">
            <div class="card-header">
              <h3 class="card-title" style="color: blue;">Danh sách người học Active trong khóa {{dataClass.className}}</h3>
        <!-- Icon Cards-->
        <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
          <thead>
            <tr>
              <th>STT</th>
              <th>Mã người học</th>
              <th>Tên người học</th>
              <th>Email</th>
              <th>Trạng thái</th>
              <th>Ngày tạo</th>
              <th> Khóa tham gia</th>
              <th>Hồ sơ</th>
              <th>Tùy chỉnh trong khóa</th>
            </tr>
          </thead>
          <tbody id="phumaTakeda">
            {{#each studentActive}}
                <tr id="{{this.id}}" name="nameTr">
                  <th>{{sum @index 1}}</td>
                  <td>{{this.id}}</td>
                  <th>{{this.name}}</th>
                  <th>{{this.email}}</th>
                  
                
                  <td>{{this.blockStatus}} block</td>
                  <td>{{this.createdAt}}</td>
                  <td>
                    <!-- <a href="add_employee_kpi.html" style="display: inline-block;"><i class="fas fa-edit"></i></a> -->
                    <a href="/admin/getAllParticipateCourseOfUser/{{this.id}}"><button type="button" class="btn btn-outline-primary">Chi tiết</button></a>
                
                  </td>
                  
                  <td style="display: flex;">
                      <a href="/viewUserProfile/{{this.id}}"><button type="button" class="btn btn-outline-dark">Hồsơ</button></a>&nbsp;
                      
                  </td>
                  <td><input name='delete' id="btnDeleteQuestion" type="button" class="btn btn-danger" value="Block"></input>&nbsp;</td>

                </tr>
            {{/each}}
          </tbody>
        </table>        
                      </div>
            </div>
          </div>
          </div>
    </div>
</div>
</div>
        <!-- Icon Cards-->
        
      <!-- /.container-fluid -->
      
    <!-- /.content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Logout Modal-->
  <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
          <a class="btn btn-primary" href="http://localhost:3000/admin/logout">Logout</a>
        </div>
      </div>
    </div>
  </div>

<!--Confirm delete Question-->
<div id="modalDeleteQuestion" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Alert</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="text-align: right;">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Bản có chắc chắn muốn chặn người dùng này trong khóa học?</p>
        <p>Chức năng sẽ không cho phép người học tiếp tục truy cập vào khóa học trong hệ thống</p>
        <p id="hideIdQuestionSecond" style="display: none;"></p>
        <p id="hideIdClass" style="display: none;">{{idClass}}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" id="btnSubmitDelete">Chặn người dùng</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
      </div>
    </div>
  </div>
</div>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="http://localhost:3000/js/Chart.min.js"></script>

<script>
      $('#phumaTakeda').click(function(event){
        //Lấy được id của người dùng
          if(event.target.name=='delete'){
            /* 
                var questionId = $(event.target).closest('tr').attr('id');
                console.log(questionId);
              //Lấy dữ liệu từ id câu hỏi
                $.ajax({
                  url:`http://localhost:3000/admin/manage-lessonquestion/delete/${questionId}`,
                  type:'post',
                  success : function(data){}
                      
                })
            */
                console.log('bolablada');
                var userId = $(event.target).closest('tr').attr('id');
                $('#hideIdQuestionSecond').val(userId);
                $('#modalDeleteQuestion').modal();
          }
      })
      $('#btnSubmitDelete').click(function(){
         console.log('Hello');
        let userId = $('#hideIdQuestionSecond').val();
        console.log(userId);
        let classId = document.getElementById('hideIdClass').innerHTML;
        $.ajax({
            url:`http://localhost:3000/admin/manage-courses/blockStudentToCourse/${userId}`,
            type:'post',
            data:{
              classId:classId
            },
            success : function(data)
            {
              
                  $('#phumaTakeda').empty();
                  let infoData = data.bla;
                  console.log(infoData);
                  for(let j = 0 ; j<infoData.length; j++){
                    let stt = j+1;
                    let id = infoData[j].id;
                    let name = infoData[j].name;
                    let email = infoData[j].email;
                    let createdAt = infoData[j].createdAt;
                    let stringInfo ="";
                    stringInfo += `<tr id='${id}' name='nameTr'>`;
                    stringInfo += `<td>${stt}</td>`
                    stringInfo += `<td id=''>${id}</td><th>${name}</th><th>${email}</th><td>NoBlock</td><td>${createdAt}</td>`;
                    stringInfo += "<td>";
                    stringInfo += `<a href='/admin/getAllParticipateCourseOfUser/${id}'><button type="button" class="btn btn-outline-primary">Chi tiết</button></a>`;
                    stringInfo += "</td>";
                    stringInfo += `<td style="display: flex;"><a href="/viewUserProfile/${id}"><button type="button" class="btn btn-outline-dark">Hồsơ</button></a>&nbsp;</td>`;
                    stringInfo += '<td><input name="delete" id="btnDeleteQuestion" type="button" class="btn btn-danger" value="Block"></input>&nbsp;</td>';
                    console.log('Dùng để block');
                    $('#phumaTakeda').append(stringInfo);
              }
              
            }
          })
          
          $('#modalDeleteQuestion').modal('hide');

            alert('Bạn đã chặn người dùng thành công');
    })
      

</script>

    <!-- Bootstrap core JavaScript-->
<script src="http://localhost:3000/vendor/jquery/jquery.min.js"></script>
<script src="http://localhost:3000/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
<script src="http://localhost:3000/vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Page level plugin JavaScript-->
<script src="http://localhost:3000/vendor/chart.js/Chart.min.js"></script>
<script src="http://localhost:3000/vendor/datatables/jquery.dataTables.js"></script>
<script src="http://localhost:3000/vendor/datatables/dataTables.bootstrap4.js"></script>

    <!-- Custom scripts for all pages-->
<script src="http://localhost:3000/js/sb-admin.min.js"></script>

    <!-- Demo scripts for this page-->
<script src="http://localhost:3000/js/demo/datatables-demo.js"></script>
<script src="http://localhost:3000/js/demo/chart-area-demo.js"></script>
