
<style type="text/css">
		.checked {
			color: orange;
		}
</style>

<nav class="navbar navbar-expand navbar-dark bg-dark static-top" style="display: flex; justify-content: space-between;">

    <a class="navbar-brand mr-1" href="/admin/home"><h4>HỆ THỐNG HỌC TRỰC TUYẾN</h4></a>

    {{!-- <button style="margin-left: -650px;"class="btn btn-link btn-sm text-white order-1 order-sm-0" id="sidebarToggle" href="#">
      <i class="fas fa-bars"></i>
    </button> --}}
    <button class="btn btn-link btn-sm text-white order-1 order-sm-0" id="sidebarToggle" href="#" style="text-align: left;">
      <i class="fas fa-bars"></i>
    </button>
    <!-- Navbar -->
    <!-- Navbar -->
    <ul class="navbar-nav ml-auto ml-md-0">
      <li class="nav-item dropdown no-arrow mx-1">
        
      </li>
      <li class="nav-item dropdown no-arrow mx-1">
        <h5 style="color: aliceblue;">Admin</h5>
      </li>
      <li class="nav-item dropdown no-arrow">
        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-user-circle fa-fw"></i>
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
          
          <a class="dropdown-item" href="/admin/profile">Hồ sơ cá nhân</a>
          <a class="dropdown-item" href="/changePassword">Đổi mật khẩu</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="/admin/logout" data-toggle="modal" data-target="#logoutModal">Đăng xuất</a>
        </div>
      </li>  
    </ul>

  </nav>

  <div id="wrapper">

    <!-- Sidebar -->
      <!-- Sidebar -->
    <ul class="sidebar navbar-nav">
      <li class="nav-item active">
        <a class="nav-link" href="#">
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Mục lục</span>
        </a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="pagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-fw fa-folder"></i>
          <span>Quản lý học tập</span>
        </a>
        <div style="width: 100%" class="dropdown-menu" aria-labelledby="pagesDropdown">
                  <a class="dropdown-item" href="/admin/manage-courses">Quản lý khóa học</a>
                  <a class="dropdown-item" href="/admin/manage-category">Quản lý chủ đề</a>
                  <a class="dropdown-item" href="/admin/manage-newregister">Quản lý đăng ký mới</a>
        </div>
      </li>      
        
       <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="pagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-fw fa-folder"></i>
          <span>Quản Lý Tài Khoản</span>
        </a>
        <div class="dropdown-menu" aria-labelledby="pagesDropdown">
          <a class="dropdown-item" href="/admin/manage-students-account">Tài khoản người học</a>
          <a class="dropdown-item" href="/admin/manage-teachers-account">Tài khoản giáo viên</a>
          
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="pagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-fw fa-folder"></i>
          <span>Cài đặt</span>
        </a>
        <div class="dropdown-menu" aria-labelledby="pagesDropdown">
          <a class="dropdown-item" href="/admin/profile">Hồ sơ cá nhân</a>
          <a class="dropdown-item" href="/admin/changePassword">Đổi mật khẩu</a>
          
        </div>
      </li>
    </ul>

    <div id="content-wrapper">

      <div class="container-fluid">

        <!-- Breadcrumbs-->
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="/admin/home">Màn hình chính</a>
          </li>
          <li class="breadcrumb-item">
             Quản lý học tập 
          </li>
           <li class="breadcrumb-item">
             Quản lý khóa học
          </li>
          
          <li class="breadcrumb-item active" >Chỉnh sửa khóa học {{dataClass.className}}</li>
        </ol>

        <!-- Icon Cards-->
          <div style="padding:10px" class="row">
                <div class="col-md-2">
                <a href="/admin/manage-courses/edit/{{dataClass.courseId}}" class="btn btn-outline-secondary btn-block mb-3">Quay lại</a>
                <a href="/admin/manage-courses/viewStudentActiveInCourse/{{idClass}}" class="btn btn-outline-info btn-block mb-3">Danh sách người học </a>
                <a href="/admin/manage-courses/viewStudentBlockInCourse/{{idClass}}" class="btn btn-outline-warning btn-block mb-3">Danh sách người học bị chặn kích hoạt trong khóa</a>
              {{#if warning}}
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                    <strong>Thất bại!</strong> Bạn đã nhập thiếu trường 
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close" style="text-align: right;">
                      <span aria-hidden="true">&times;</span>
                    </button>
                    </div>
              {{/if}}
              {{#if notification}}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                <strong>Thành công!</strong> Bạn đã chỉnh sửa khóa học thành công
                <button type="button" class="close" data-dismiss="alert" aria-label="Close" style="text-align: right;">
                  <span aria-hidden="true">&times;</span>
                </button>
                </div>
              {{/if}}
              {{#if notificationsecond}}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                <strong>Thành công!</strong> Không có thông tin cần chỉnh sưả
                <button type="button" class="close" data-dismiss="alert" aria-label="Close" style="text-align: right;">
                  <span aria-hidden="true">&times;</span>
                </button>
                </div>
              {{/if}}
          </div>
        <div class="col-md-10">
          <div class="card card-primary card-outline">
            <div class="card-header">
              <h3 class="card-title" style="color: blue;">Chỉnh sửa khóa học {{dataClass.className}}</h3>
        <form method="POST" action="/admin/manage-class/edit/{{idClass}}">
            <div class="form-group">
              <label for="exampleFormControlInput1"><h5>Tên khóa học muốn chỉnh sửa</h5></label>
              <input type="text" class="form-control" id="exampleFormControlInput1" value="{{dataClass.className}}" name="className">
            </div>
            <div class="form-group">
              <label for="exampleFormControlInput1"><h5>Trạng thái khóa học :</h5> </label>
              <select name ='classStatus' class="form-select form-select-sm" aria-label=".form-select-sm example">
                  <option selected value="{{dataClass.classStatus}}">{{dataClass.classStatus}}</option>
                  
                  <option  value="active">active</option>
                  <option  value="notactive">Not active</option>
                  
              </select>
            </div>
            


            {{#if infoExistTeacher}}
                              <div class="form-group">
                                <label for="exampleFormControlInput1"><h5>Giáo viên:</h5> </label>
                                <select name ='classTeacher' class="form-select form-select-sm" aria-label=".form-select-sm example">
                                    <option value="{{infoExistTeacher.id}}" selected>Đang chọn {{infoExistTeacher.name}}</option>
                                    {{#each infoTeacher}}
                                      <option  value="{{this.id}}">{{this.name}}</option>
                                    {{/each}}
                                    
                                </select>
                              </div> 
                            {{else }}
                              <div class="form-group">
                                <label for="exampleFormControlInput1"><h5>Giáo viên:</h5> </label>
                                <select name ='classTeacher' class="form-select form-select-sm" aria-label=".form-select-sm example">
                                    
                                    {{#each infoTeacher}}
                                      <option  value="{{this.id}}">{{this.name}}</option>
                                    {{/each}}
                                    
                                </select>
                              </div> 
                                    
                              {{/if }}



            

            <div class="form-group row">
              <label for="example-date-input" class="col-2 col-form-label">Ngày bắt đầu</label>
              <div class="col-10">
                  <input class="form-control" type="date" value='{{dataClass.dayStart}}' id="example-date-input" name="dayStart">
              </div>
            </div>

            <div class="form-group row">
              <label for="example-date-input" class="col-2 col-form-label">Ngày kết thúc</label>
              <div class="col-10">
                  <input class="form-control" type="date" value='{{dataClass.dayEnd}}' id="example-date-input" name="dayEnd">
              </div>
            </div>

            <br>
              <label for="description"><h5>Ảnh Avatar khóa học</h5> </label>
              <div class="form-group">
                  
                  <img width="100" height="120" id="imgprofile" class="rounded-circle mt-5" src="http://localhost:3000/{{dataClass.classAvatarImg}}"><span class="font-weight-bold"></span><span class="text-black-50"></span>
                  <input class="form-control" type="file" id="myfile" name="myFile" multiple>
                  <input type="text" style="display: none;" id="assignLink" name="assignLink">
              </div>
              <div class="form-group">
                  <input onclick="send()" id="btnupload" class="btn btn-outline-info" type="button" value="Upload">
              </div>

            <div class="form-group">
              <label for="description"><h5>Mô tả khóa học</h5> </label>
              <textarea minlength="8" placeholder="Mô tả khóa học" class="form-control" id="descriptionn" rows="3" name="classDescription">{{dataClass.classDescription}}</textarea>
            </div>
            <div class="form-group">
              <label for="description"><h5>Giá Khóa học : {{dataClass.classPrice}} đ</h5> </label>
              
            </div>
            
            <button class="btn btn-outline-success btn-block mb-3" type="submit">Chỉnh sửa</button>  

        </form>    

    

    <!-- Sidebar -->
      

    

      <div class="container-fluid">

        <!-- Breadcrumbs-->
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="../homescreen.html">Chỉnh sửa khóa học</a>
          </li>
          <li class="breadcrumb-item">
             Danh sách tiết học của khóa {{dataClass.className}}
          </li>
        </ol>
        <div style="padding:10px" class="row">
                <div class="col-md-3">
 
                <a href="/admin/manage-lesson/create/{{idClass}}" class="btn btn-primary btn-block mb-3" role="button" aria-pressed="true"><img src="https://img.icons8.com/cotton/2x/plus.png" alt="" style="max-height: 30px; max-width: 30px;">Thêm tiết học</a>
                
              </div>

        <div class="col-md-12">
          <div class="card card-primary card-outline">
            <div class="card-header">
              <h3 class="card-title">Danh sách tiết học của khóa {{dataClass.className}}</h3>
        <!-- Icon Cards-->
        <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
          <thead>
            <tr>
              <th>STT</th>
              <th>Mã tiết </th>
              <th>Tên tiết học</th>
              <th>Bài luyện tập</th>
              
              
              <th>Người tạo</th>
              <th>Tùy chỉnh</th>
            </tr>
          </thead>
          
            <tbody id="phumaTakeda">
                {{#each dataLesson}}
                  <tr id="{{this.id}}">
                    <th>{{sum @index 1}}</th>
                    <td>{{this.id}}</td>
                    <td>{{this.lessonName}}</td>
                    <td><button onclick="location.href='/admin/manage-lessonquestion/{{this.id}}'" type="button" class="btn btn-link">Bài tập</button></td>
                    
                  
                    <td>Admin</td>
                   
                    
                    <td style="display: flex;">
                      <button onclick="location.href='/admin/manage-lesson/edit/{{this.id}}'" type="button" class="btn btn-warning">Sửa</button>&nbsp;
                      <input name='delete' id="btnDeleteQuestion" type="button" class="btn btn-danger" value="Xóa tiết học"></input>
                    </td>
                  </tr>
                {{/each}}
            </tbody>
          
        </table>        
                      </div>
            </div>
          </div>
          </div>
      </div>
      <!-- /.container-fluid -->
        

    
</div>

        
      <!-- /.container-fluid -->
        

    </div>
      <!-- /.container-fluid -->
        
    <!-- /.content-wrapper -->

  </div>
  <!-- /#wrapper -->
 
  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  

<textarea style="display: none;" class="form-control" id="clgt" rows="1" placeholder="Đáp án B">{{idClass}}</textarea>

  <!-- Logout Modal-->
  <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
          <a class="btn btn-primary" href="http://localhost:3000/admin/logout">Logout</a>
        </div>
      </div>
    </div>
  </div>

  <!--Confirm delete Lesson In course-->
<div id="modalDeleteQuestion" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Alert</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="text-align: right;">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Bản có chắc chắn muốn xóa tiết học này không?</p>
        <p>Chức năng sẽ xóa cả những dữ liệu liên quan đến tiết học</p>
        <p id="hideIdQuestionSecond" style="display: none;"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" id="btnSubmitDelete">Xóa tiết học</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
      </div>
    </div>
  </div>
</div>

  <script src="http://localhost:3000/js/Chart.min.js"></script>

    <script type="text/javascript">
    //doughnut
    var ctxD = document.getElementById("doughnutChart").getContext('2d');
    var myLineChart = new Chart(ctxD, {
        type: 'doughnut',
        data: {
        labels: ["Danger", "Done", "Todo", "Doing"],
        datasets: [{
        data: [40, 300, 100, 50],
        backgroundColor: ["#d9534f", "#5cb85c", "#ffff00", "#428bca"],
        hoverBackgroundColor: ["#FF5A5E", "#5AD3D1", "#FFC870", "#A8B3C5"]
        }]
        },
        options: {
        responsive: true 
        }
    });
    </script>

<script>
          $('#phumaTakeda').click(function(event){
          //Lấy được id của câu hỏi
            
            if(event.target.name=='delete'){
              
                  var lessonId = $(event.target).closest('tr').attr('id');
                  $('#hideIdQuestionSecond').val(lessonId);
                  $('#modalDeleteQuestion').modal();
            }
          })

          /*Xác nhận muốn xóa khóa học*/
          $('#btnSubmitDelete').click(function(){
            
              let lessonId = $('#hideIdQuestionSecond').val();
              console.log("Thông tin của lesson Id là :");
              console.log(lessonId);
              
              let classId =  $('#clgt').html();
              console.log('Thông tin classId')
              console.log(classId);
              $.ajax({
                  url:`http://localhost:3000/admin/manage-lesson/delete/${lessonId}`,
                  type:'post',
                  data:{
                    classId:classId
                  },
                  success : function(data)
                  {
                    console.log(data.bla);
                    
                        $('#phumaTakeda').empty();
                        let infoData = data.bla;
                        console.log(infoData);
                        for(let j = 0 ; j<infoData.length; j++){
                          let id = infoData[j].id;
                          let lessonName = infoData[j].lessonName;
                          let stringInfo ="";
                          stringInfo += `<tr id='${id}'>`;
                          stringInfo += `<td id='blabla'>${id}</td><td>${lessonName}</td>`;
                          //Nút bài tập
                          stringInfo += "<td><button onclick='location.href=`/admin/manage-lessonquestion/${id}`' type='button' class='btn btn-link'>Bài tập</button></td>";
                          stringInfo += "<td></td><td>Admin</td>";
                          stringInfo += "<td><button type='button' class='btn btn-info'>Danh sách</button></td>";
                          stringInfo += "<td style='display: flex;'>";
                          //Nút sửa tiết học
                          stringInfo +="<button onclick='location.href=`/admin/manage-lesson/edit/${id}`' type='button' class='btn btn-warning'>Sửa</button>&nbsp;";
                          stringInfo += "<input name='delete' id='btnDeleteQuestion' type='button' class='btn btn-danger' value='Xóa tiết học'></input>";
                          stringInfo +="</td>";
                          stringInfo +="</tr>";
                          $('#phumaTakeda').append(stringInfo);
                        }
                  }
              })
                $('#modalDeleteQuestion').modal('hide');
                alert('Bạn đã xóa tiết học thành công');
          })

</script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
            var send = function(){
                let myfile = document.getElementById('myfile').files;
                let formData = new FormData();
                for(let i = 0 ; i<myfile.length ; i++){
                    formData.append('myfile',myfile[i]);
                }
                let contentType = {
                  headers :{
                      "content-type":"multipart/form-data"
                  }
                }
              let link = '';
              axios.post('http://localhost:3000/admin/profile/uploadPictureProfile',formData,contentType)
              .then(function (response) {
                  link = response.data.filename;
                  $("#imgprofile").attr("src", "http://localhost:3000/"+link);
                  $('#assignLink').val(link);
              })
              .catch(function (error) {
                  console.log(error);
              });
              //Set giá trị khi truyền lên download
           
        }
    </script>
    

    <!-- Bootstrap core JavaScript-->
    <script src="http://localhost:3000/vendor/jquery/jquery.min.js"></script>
    <script src="http://localhost:3000/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="http://localhost:3000/vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Page level plugin JavaScript-->
    <script src="http://localhost:3000/vendor/chart.js/Chart.min.js"></script>
    <script src="http://localhost:3000/vendor/datatables/jquery.dataTables.js"></script>
    <script src="http://localhost:3000/vendor/datatables/dataTables.bootstrap4.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="http://localhost:3000/js/sb-admin.min.js"></script>

    <!-- Demo scripts for this page-->
    <script src="http://localhost:3000/js/demo/datatables-demo.js"></script>
    <script src="http://localhost:3000/js/demo/chart-area-demo.js"></script>
